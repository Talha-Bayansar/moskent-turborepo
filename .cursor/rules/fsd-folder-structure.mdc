---
alwaysApply: true
---

ğŸ“˜ Moskent â€” Feature-Sliced Design (FSD) Folder Structure Rules

This project follows Feature-Sliced Design methodology adapted for TanStack Start monorepo architecture. All folder structures must adhere to these rules.

ğŸ—ï¸ Monorepo Architecture Overview

The project is organized as a monorepo with clear separation between applications and shared packages:

```
moskent-turborepo/
â”œâ”€â”€ apps/                          # Application layer (FSD: app)
â”‚   â”œâ”€â”€ moskent-core/              # Desktop-first admin dashboard
â”‚   â””â”€â”€ activity-manager/          # Mobile-first PWA
â”‚
â””â”€â”€ packages/                      # Shared infrastructure (FSD: shared)
    â”œâ”€â”€ auth/                      # Authentication & authorization
    â”œâ”€â”€ db/                        # Database schemas & client
    â”œâ”€â”€ ui/                        # Shared UI components
    â””â”€â”€ modules/                   # Shared business logic (future)
```

ğŸ“ Application-Level Structure (apps/*/src/)

Each application follows FSD layers adapted for TanStack Start:

```
apps/{app-name}/src/
â”œâ”€â”€ routes/                        # FSD: pages layer (TanStack Router file-based)
â”‚   â”œâ”€â”€ __root.tsx                 # Root route layout
â”‚   â”œâ”€â”€ index.tsx                  # Landing/home page
â”‚   â”œâ”€â”€ (auth-pages)/              # Route group for auth pages
â”‚   â”‚   â”œâ”€â”€ route.tsx              # Layout route
â”‚   â”‚   â”œâ”€â”€ login.tsx              # Login page
â”‚   â”‚   â””â”€â”€ signup.tsx              # Signup page
â”‚   â”œâ”€â”€ (authenticated)/           # Route group for protected pages
â”‚   â”‚   â”œâ”€â”€ route.tsx              # Auth guard layout
â”‚   â”‚   â”œâ”€â”€ dashboard/             # Dashboard feature page
â”‚   â”‚   â”‚   â”œâ”€â”€ route.tsx          # Route config
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx          # Page component
â”‚   â”‚   â”œâ”€â”€ contacts/              # Contacts feature page
â”‚   â”‚   â”‚   â”œâ”€â”€ route.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx          # List view
â”‚   â”‚   â”‚   â””â”€â”€ $id.tsx            # Detail view
â”‚   â”‚   â”œâ”€â”€ activities/            # Activities feature page
â”‚   â”‚   â””â”€â”€ [other-features]/      # Other feature pages
â”‚   â””â”€â”€ api/                       # API routes (server functions)
â”‚       â””â”€â”€ {feature}/              # Feature-scoped API routes
â”‚           â””â”€â”€ $.ts               # Server function handlers
â”‚
â”œâ”€â”€ features/                      # FSD: features layer
â”‚   â”œâ”€â”€ auth/                      # Authentication feature
â”‚   â”‚   â”œâ”€â”€ ui/                    # Feature-specific UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ sign-in-form.tsx
â”‚   â”‚   â”‚   â””â”€â”€ sign-out-button.tsx
â”‚   â”‚   â”œâ”€â”€ model/                 # Feature business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks.ts           # React hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ queries.ts         # TanStack Query hooks
â”‚   â”‚   â”‚   â””â”€â”€ mutations.ts       # TanStack Query mutations
â”‚   â”‚   â””â”€â”€ api/                   # Feature server functions
â”‚   â”‚       â””â”€â”€ functions.ts       # createServerFn exports
â”‚   â”‚
â”‚   â”œâ”€â”€ contacts/                  # Contacts management feature
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”œâ”€â”€ contact-list.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ contact-form.tsx
â”‚   â”‚   â”‚   â””â”€â”€ contact-card.tsx
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ queries.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ mutations.ts
â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â””â”€â”€ functions.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ activities/                # Activities feature
â”‚   â”œâ”€â”€ attendance/                # Attendance feature
â”‚   â”œâ”€â”€ organizations/             # Organization management
â”‚   â”œâ”€â”€ teams/                     # Teams management
â”‚   â””â”€â”€ [other-features]/          # Additional features
â”‚
â”œâ”€â”€ entities/                      # FSD: entities layer
â”‚   â”œâ”€â”€ contact/                   # Contact entity
â”‚   â”‚   â”œâ”€â”€ ui/                    # Entity UI components
â”‚   â”‚   â”‚   â””â”€â”€ contact-avatar.tsx
â”‚   â”‚   â”œâ”€â”€ model/                 # Entity business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”‚   â””â”€â”€ api/                   # Entity server functions
â”‚   â”‚       â””â”€â”€ functions.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ activity/                  # Activity entity
â”‚   â”œâ”€â”€ organization/              # Organization entity
â”‚   â”œâ”€â”€ team/                      # Team entity
â”‚   â””â”€â”€ [other-entities]/          # Additional entities
â”‚
â”œâ”€â”€ widgets/                       # FSD: widgets layer (optional, for complex compositions)
â”‚   â”œâ”€â”€ dashboard-stats/           # Dashboard statistics widget
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â””â”€â”€ dashboard-stats.tsx
â”‚   â”‚   â””â”€â”€ model/
â”‚   â”‚       â””â”€â”€ hooks.ts
â”‚   â”‚
â”‚   â””â”€â”€ [other-widgets]/
â”‚
â”œâ”€â”€ shared/                        # FSD: shared layer (app-specific)
â”‚   â”œâ”€â”€ ui/                        # App-specific UI components
â”‚   â”‚   â”œâ”€â”€ default-catch-boundary.tsx
â”‚   â”‚   â”œâ”€â”€ default-not-found.tsx
â”‚   â”‚   â””â”€â”€ theme-toggle.tsx
â”‚   â”œâ”€â”€ lib/                       # App-specific utilities
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â””â”€â”€ config/                    # App-specific configuration
â”‚
â”œâ”€â”€ components/                    # Legacy/global components (prefer shared/ui)
â”‚   â””â”€â”€ [migrate to shared/ui]/
â”‚
â”œâ”€â”€ router.tsx                     # TanStack Router configuration
â””â”€â”€ styles.css                     # Global styles
```

ğŸ“¦ Shared Packages Structure (packages/*)

Shared packages represent cross-cutting concerns and business logic:

```
packages/
â”œâ”€â”€ auth/                          # Authentication package
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ auth.ts                # Better Auth configuration
â”‚       â”œâ”€â”€ auth-client.ts         # Client-side auth
â”‚       â””â”€â”€ tanstack/              # TanStack integration
â”‚           â”œâ”€â”€ queries.ts         # Query options
â”‚           â”œâ”€â”€ functions.ts       # Server functions
â”‚           â””â”€â”€ middleware.ts      # Route middleware
â”‚
â”œâ”€â”€ db/                            # Database package
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts               # Database client export
â”‚       â””â”€â”€ schema/                # Drizzle schemas
â”‚           â”œâ”€â”€ index.ts
â”‚           â”œâ”€â”€ auth.schema.ts
â”‚           â”œâ”€â”€ contacts.schema.ts
â”‚           â”œâ”€â”€ activities.schema.ts
â”‚           â””â”€â”€ [other-schemas].ts
â”‚
â”œâ”€â”€ ui/                            # Shared UI components package
â”‚   â””â”€â”€ [components, hooks, lib]   # Base UI shadcn components
â”‚
â””â”€â”€ modules/                       # Shared business logic (future)
    â””â”€â”€ {feature-module}/          # Feature-scoped modules
        â”œâ”€â”€ queries/               # Shared query hooks
        â”œâ”€â”€ mutations/             # Shared mutation hooks
        â”œâ”€â”€ server/                # Shared server functions
        â”œâ”€â”€ types/                 # Shared TypeScript types
        â””â”€â”€ validation/            # Shared validation schemas
```

ğŸ¯ FSD Layer Rules & Import Hierarchy

1. **Import Direction (Dependency Flow)**
   - `routes` (pages) â†’ `features` â†’ `entities` â†’ `shared` â†’ `packages`
   - Lower layers CANNOT import from higher layers
   - Same layer imports are allowed (features can import from features)
   - Cross-layer imports must follow the hierarchy

2. **Layer Responsibilities**

   **routes/** (Pages Layer)
   - TanStack Router file-based routes only
   - Route configuration and page composition
   - Minimal logic; delegate to features/entities
   - Example: `routes/(authenticated)/contacts/index.tsx`

   **features/** (Features Layer)
   - Complete user-facing features
   - Feature-specific UI, business logic, and API
   - Can use multiple entities
   - Example: `features/contacts/` (full contacts management)

   **entities/** (Entities Layer)
   - Business entities (Contact, Activity, Organization, etc.)
   - Reusable entity logic and UI
   - Single responsibility per entity
   - Example: `entities/contact/` (contact data model & basic UI)

   **widgets/** (Widgets Layer - Optional)
   - Complex UI compositions
   - Combine multiple features/entities
   - Example: `widgets/dashboard-stats/` (combines multiple features)

   **shared/** (Shared Layer)
   - App-specific shared utilities
   - App-specific UI components
   - NOT cross-app shared code (use packages/ for that)

   **packages/** (Infrastructure Layer)
   - Cross-app shared code
   - Infrastructure concerns (auth, db, ui)
   - Business logic modules

3. **Feature Structure Template**

   Each feature in `features/{feature-name}/` must follow:

   ```
   features/{feature-name}/
   â”œâ”€â”€ ui/                          # Feature UI components
   â”‚   â””â”€â”€ {component-name}.tsx
   â”œâ”€â”€ model/                       # Feature business logic
   â”‚   â”œâ”€â”€ hooks.ts                 # Custom React hooks
   â”‚   â”œâ”€â”€ queries.ts               # TanStack Query queries
   â”‚   â”œâ”€â”€ mutations.ts             # TanStack Query mutations
   â”‚   â”œâ”€â”€ types.ts                 # TypeScript types
   â”‚   â””â”€â”€ utils.ts                 # Utility functions
   â””â”€â”€ api/                         # Server functions (TanStack Start)
       â””â”€â”€ functions.ts             # createServerFn exports
   ```

4. **Entity Structure Template**

   Each entity in `entities/{entity-name}/` must follow:

   ```
   entities/{entity-name}/
   â”œâ”€â”€ ui/                          # Entity UI components
   â”‚   â””â”€â”€ {component-name}.tsx
   â”œâ”€â”€ model/                       # Entity business logic
   â”‚   â”œâ”€â”€ types.ts                 # Entity TypeScript types
   â”‚   â””â”€â”€ utils.ts                 # Entity utilities
   â””â”€â”€ api/                         # Entity server functions
       â””â”€â”€ functions.ts             # createServerFn exports
   ```

ğŸ”— TanStack Start Integration Rules

1. **Server Functions**
   - Server functions live in `features/{feature}/api/functions.ts` or `entities/{entity}/api/functions.ts`
   - API routes in `routes/api/{feature}/$.ts` can re-export or compose server functions
   - Use `createServerFn` from `@tanstack/react-start`

2. **Query Keys**
   - All query keys must be defined in feature/entity `model/queries.ts`
   - Use module-scoped query keys (e.g., `["contacts", "list"]`)
   - Never hardcode query keys inline
   - Shared query keys go in `packages/modules/{feature}/queries/keys.ts`

3. **Route Organization**
   - Routes follow TanStack Router file-based routing
   - Route groups: `(auth-pages)`, `(authenticated)`, etc.
   - Feature routes: `routes/(authenticated)/{feature}/`
   - Route files: `route.tsx` for config, `index.tsx` for page component

4. **Data Loading**
   - Use `beforeLoad` in route files for prefetching
   - Use TanStack Query `prefetchQuery` in loaders
   - Delegate data fetching to feature hooks/queries

ğŸ“‹ Naming Conventions

1. **Folders**: kebab-case (`contacts-management`, `activity-tracker`)
2. **Files**: kebab-case for components (`contact-list.tsx`), camelCase for utilities (`formatDate.ts`)
3. **Features**: Singular noun (`contacts`, `activities`, `attendance`)
4. **Entities**: Singular noun (`contact`, `activity`, `organization`)
5. **Components**: PascalCase (`ContactList`, `ActivityCard`)
6. **Hooks**: camelCase with `use` prefix (`useContacts`, `useActivityForm`)

ğŸš« Anti-Patterns to Avoid

1. âŒ **Don't** put business logic in route files
2. âŒ **Don't** create circular dependencies between features
3. âŒ **Don't** import from higher FSD layers
4. âŒ **Don't** put shared cross-app code in `shared/` (use `packages/`)
5. âŒ **Don't** mix feature logic in entity folders
6. âŒ **Don't** create deeply nested feature folders (>3 levels)
7. âŒ **Don't** duplicate code across features (extract to entities or packages)

âœ… Best Practices

1. âœ… **Do** keep features self-contained and independent
2. âœ… **Do** extract reusable logic to entities
3. âœ… **Do** use shared packages for cross-app concerns
4. âœ… **Do** follow the import hierarchy strictly
5. âœ… **Do** colocate related code (UI, model, API together)
6. âœ… **Do** use TypeScript types from entities in features
7. âœ… **Do** keep route files thin (delegate to features)

ğŸ“š Example: Contacts Feature Implementation

```
features/contacts/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ contact-list.tsx           # Uses entities/contact/ui
â”‚   â”œâ”€â”€ contact-form.tsx
â”‚   â””â”€â”€ contact-filters.tsx
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ hooks.ts                   # useContacts, useContactFilters
â”‚   â”œâ”€â”€ queries.ts                 # contactListQuery, contactDetailQuery
â”‚   â”œâ”€â”€ mutations.ts               # createContactMutation, updateContactMutation
â”‚   â””â”€â”€ types.ts                   # ContactFormData, ContactFilters
â””â”€â”€ api/
    â””â”€â”€ functions.ts               # $getContacts, $createContact, $updateContact

entities/contact/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ contact-avatar.tsx
â”‚   â””â”€â”€ contact-card.tsx
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ types.ts                   # Contact type from db schema
â”‚   â””â”€â”€ utils.ts                   # formatContactName, validateEmail
â””â”€â”€ api/
    â””â”€â”€ functions.ts               # $getContactById (if needed)

routes/(authenticated)/contacts/
â”œâ”€â”€ route.tsx                       # beforeLoad: prefetchQuery(contactListQuery())
â””â”€â”€ index.tsx                       # <ContactList /> from features/contacts/ui
```

This structure ensures:
- Clear separation of concerns
- Reusable components and logic
- Scalable architecture
- Easy feature discovery
- Consistent patterns across the codebase
